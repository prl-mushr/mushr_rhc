jobs:
- job:
  displayName: From environment.yml
  pool:
    vmImage: 'ubuntu-16.04'
  
  variables:
    azure_tmpdir: $(Agent.TempDirectory)
    devtools: $(azure_tmpdir)/devtools
    devtools_bin: $(devtools)/bin
    test_dir: mushr_rhc_ros/test

  container: prlmushr/mushr:xenial

  steps:
  - script: git clone https://github.com/prl-mushr/devtools.git $(devtools)
    displayName: Get devtools

  - bash: |
      sudo apt-get update
      wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
      bash miniconda.sh -b -p $HOME/miniconda
      export PATH="$HOME/miniconda/bin:$PATH"
      hash -r
      conda config --set always_yes yes --set changeps1 no
      conda update -q conda
      conda info -a
      which conda
      conda --version
      echo $PATH
      source $HOME/miniconda/etc/profile.d/conda.sh
    displayName: 'Setup conda/install dependencies'

  - bash: |
      conda env create --quiet --file $(devtools)/lint-env.yaml
    displayName: Create Anaconda environment
    noProfile: false
    noRc: false

  - bash: |
      source activate lint
      $(devtools)/bin/mushr_lint_flake8
    displayName: flake8
    noProfile: false
    noRc: false
